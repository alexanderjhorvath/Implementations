<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>Account Signup!</title>
  </head>
  <body>
    <script src="//cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.2/rollups/hmac-sha256.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.2/components/enc-base64-min.js"></script>
    <h2>Sign up for an account!</h2>
    <form action="" method="GET">
      <label for="firstname">First Name</label>
      <input type="text" name="firstname" id="firstname">
      <label for="lastname">Last Name</label>
      <input type="text" name="lastname" id="lastname">
      <label for="email">Email Address</label>
      <input type="text" name="email" id="email">
      <label for="referralcode">Referral Code</label>
      <input type="text" name="referralcode" id="referralcode" value="">
      <label for="jwt">JWT</label>
      <input type="text" name="jwt" id="jwt" value="" disabled="disabled">
      <input type="button" value="Create JWT" onclick="createJWT(document.forms[0].firstname.value, document.forms[0].lastname.value, document.forms[0].email.value)">
    </form>
    <script>
      function createJWT(firstName, lastName, email) {

        var header = {
          "alg": "HS256",
          "typ": "JWT"
        };

        var data = {
          "id": firstName + lastName,
          "accountId": firstName + lastName,
          "firstName": firstName,
          "lastName": lastName,
          "email": email
        };

        console.log(data);

        var secret = "My very confidential secret!!!";

        function base64url(source) {
          // Encode in classical base64
          encodedSource = CryptoJS.enc.Base64.stringify(source);

          // Remove padding equal characters
          encodedSource = encodedSource.replace(/=+$/, '');

          // Replace characters according to base64url specifications
          encodedSource = encodedSource.replace(/\+/g, '-');
          encodedSource = encodedSource.replace(/\//g, '_');

          return encodedSource;
        }

        var stringifiedHeader = CryptoJS.enc.Utf8.parse(JSON.stringify(header));
        var encodedHeader = base64url(stringifiedHeader);
        document.getElementById("header").innerText = encodedHeader;

        var stringifiedData = CryptoJS.enc.Utf8.parse(JSON.stringify(data));
        var encodedData = base64url(stringifiedData);
        document.getElementById("payload").innerText = encodedData;

        var signature = encodedHeader + "." + encodedData;
        signature = CryptoJS.HmacSHA256(signature, secret);
        signature = base64url(signature);

        document.getElementById("signature").innerText = signature;
        document.getElementById("jwt").value = "test";
      }
    </script>
    <p>
      <strong>JSON Web Token:</strong><br/>
      <span id="header"></span>.<span id="payload"></span>.<span id="signature"></span>
    </p>
  </body>
</html>
